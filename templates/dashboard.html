<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FinancialAid - Dashboard</title>

  <!-- Bootstrap & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

  <!-- ===== Navbar ===== -->
  <nav class="navbar navbar-expand-lg shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="{{ url_for('dashboard') }}">FinancialAid</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('predictions') }}">View Predictions</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('upload_data') }}">Upload Data</a></li>
          <li class="nav-item"><a class="nav-link btn btn-primary text-white px-3 ms-2" href="{{ url_for('logout') }}">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ===== Dashboard Content ===== -->
  <section class="py-5" style="margin-top: 80px; background-color: #fff;">
    <div class="container text-center">
      <h2 class="fw-bold mb-3" style="color: #6B5B95;">Welcome, {{ first_name }}!</h2>
      <p class="text-muted mb-5">Use the options below to manage financial aid predictions and student data.</p>

      <div class="row justify-content-center gy-4">

      <!-- ===== Analytics Charts ===== -->
      <div class="row justify-content-center mt-5">
        <!-- Eligibility Distribution -->
        <div class="col-md-6 mb-4">
          <div class="card p-4 h-100 border-0 shadow-sm">
            <div class="card-body">
              <h5 class="card-title fw-semibold">Eligibility Distribution</h5>
              <canvas id="eligibilityChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Aid Trends Over Time -->
        <div class="col-md-6 mb-4">
          <div class="card p-4 h-100 border-0 shadow-sm">
            <div class="card-body">
              <h5 class="card-title fw-semibold">Aid Trends Over Time</h5>
              <canvas id="trendChart"></canvas>
            </div>
          </div>
        </div>
      </div>

       <div class="row justify-content-center gy-4">
  <!-- Flip Card 1 -->
  <div class="col-md-4">
    <a href="{{ url_for('predictions') }}" class="flip-card">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          Show Eligibility Predictions
        </div>
        <div class="flip-card-back">
          See all current eligibility predictions made by the model, along with explanations and student details.
        </div>
      </div>
    </a>
  </div>

  <!-- Flip Card 2 -->
  <div class="col-md-4">
    <a href="{{ url_for('upload_data') }}" class="flip-card">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          Upload Data
        </div>
        <div class="flip-card-back">
          Upload new student records (CSV or manual entry) for the model to predict eligibility.
        </div>
      </div>
    </a>
  </div>
</div>

    </div>
  </section>
  <!-- ===== Footer ===== -->
  <footer class="footer">
    <div class="container">
      <p class="mb-0">Â© 2025 FinancialAid System. All rights reserved.</p>
    </div>
  </footer>

  <!-- Bootstrap & Chart.js Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- JSON Data From Flask  -->
  <script id="chart-data" type="application/json">
  {
    "eligible_count": {{ eligible_count }},
    "not_eligible_count": {{ not_eligible_count }},
    "trend_periods": {{ trend_periods | tojson }},
    "trend_counts": {{ trend_counts | tojson }}
  }
  </script>

  <!-- JS CHARTS -->
  <script>
  // Read the embedded JSON from Flask
  const chartData = JSON.parse(
    document.getElementById("chart-data").textContent
  );

  // =============================
  //   Eligibility Pie Chart
  // =============================
  const eligibilityData = {
    labels: ["Eligible", "Not Eligible"],
    datasets: [{
      label: "Students",
      data: [
        chartData.eligible_count,
        chartData.not_eligible_count
      ],
      backgroundColor: ["#6B5B95", "#D9D4F3"],
      borderWidth: 1
    }]
  };

  new Chart(document.getElementById("eligibilityChart"), {
    type: "pie",
    data: eligibilityData
  });

  //   Aid Trends Over Time Line Chart
  new Chart(document.getElementById("trendChart"), {
    type: "line",
    data: {
      labels: chartData.trend_periods,  // Example: ["2025-S1", "2025-S2", "2026-S1"]
      datasets: [{
        label: "Eligible Students Over Time",
        data: chartData.trend_counts,   // Example: [80, 120, 140]
        borderColor: "#6B5B95",
        backgroundColor: "rgba(107, 91, 149, 0.2)",
        borderWidth: 3,
        tension: 0.4,
        pointRadius: 5,
        pointBackgroundColor: "#6B5B95",
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: "Number of Eligible Students" }
        },
        x: {
          title: { display: true, text: "Semester / Period" }
        }
      }
    }
  });
</script>

</body>
</html>
