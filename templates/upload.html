<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload Student Data</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body style="background-color: #fff; font-family: 'Poppins', sans-serif;">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="{{ url_for('dashboard') }}" style="color:#6B5B95;">FinancialAid</a>
      <div class="d-flex">
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary me-2">Back to Dashboard</a>
        <a href="{{ url_for('logout') }}" class="btn btn-primary text-white">Logout</a>
      </div>
    </div>
  </nav>

  <!-- Upload Section -->
  <section class="py-5" style="margin-top: 60px;">
    <div class="container" style="max-width: 900px;">
      <h2 class="fw-bold text-center mb-4" style="color:#6B5B95;">Upload Student Data for Prediction</h2>
      <p class="text-center text-muted mb-5">
        Upload your student dataset (CSV) or manually enter student details below.
      </p>

      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
      <div class="container mb-4">
        {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show shadow-sm" role="alert">
          <strong>{{ 'Success!' if category == 'success' else 'Error:' }}</strong> {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
      </div>
      {% endif %}
      {% endwith %}

      <!-- CSV Upload -->
      <form action="{{ url_for('upload_data') }}" method="POST" enctype="multipart/form-data" class="mb-5">
        <div class="card p-4 shadow-sm border-0" style="background-color: #EDE9FE;">
          <h5 class="fw-semibold mb-3" style="color:#6B5B95;">Upload CSV File</h5>
          <p class="text-muted mb-3">Select a CSV file with student data to predict eligibility for multiple students.</p>
          <input type="file" name="csv_file" accept=".csv" class="form-control mb-3" required>
          <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold">Upload & Predict</button>
        </div>
      </form>

      <!-- Manual Entry -->
      <div class="card p-4 shadow-sm border-0" style="background-color: #EDE9FE;">
        <h5 class="fw-semibold mb-3" style="color:#6B5B95;">Manual Entry</h5>
        <p class="text-muted mb-3">Enter details for a single student to predict eligibility.</p>

        <form action="{{ url_for('upload_data') }}" method="POST">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Age</label>
              <input type="number" name="age" class="form-control" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Gender</label>
              <select name="gender" class="form-select">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Background</label>
              <select name="background" class="form-select">
                <option value="Rural">Rural</option>
                <option value="Urban">Urban</option>
              </select>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Household Income Bracket</label>
              <select name="household_income_bracket" class="form-select">
                <option value="Low">Low</option>
                <option value="Mid-Low">Mid-Low</option>
                <option value="Mid-High">Mid-High</option>
                <option value="High">High</option>
              </select>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Performance Score</label>
              <input type="number" name="performance_score" class="form-control" step="0.01" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Study Hours</label>
              <input type="number" name="study_hours" class="form-control" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Attendance (%)</label>
              <input type="number" name="attendance" class="form-control" step="0.1" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Dependents</label>
              <input type="number" name="dependents" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Government Assistance</label>
              <select name="government_assistance" class="form-select">
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>

          <button type="submit" class="btn btn-success w-100 py-2 fw-semibold">Predict for Single Student</button>
        </form>
      </div>

      <!-- ===== Display Uploaded Data ===== -->
      {% if uploaded_data %}
      <div class="mt-5">
          <h4 class="mb-3">Uploaded Student Data</h4>

          <div class="table-responsive">
              <table class="table table-striped table-bordered shadow-sm">
                  <thead class="table-light" style="background-color:#EDE9FE;">
                      <tr>
                          {% for col in uploaded_data[0].keys() %}
                          <th>{{ col.replace('_', ' ') | title }}</th>
                          {% endfor %}
                      </tr>
                  </thead>

                  <tbody>
                      {% for row in uploaded_data %}
                      <tr>
                          {% for value in row.values() %}
                          <td>{{ value }}</td>
                          {% endfor %}
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>
      </div>
      {% endif %}

      <!-- Prediction Results -->
      {% if prediction_results %}
      <div class="mt-5">
        <h4 class="fw-bold" style="color:#6B5B95;">Prediction Results</h4>
        <div class="table-responsive mt-3">
          <table class="table table-bordered align-middle shadow-sm">
            <thead class="table-light">
              <tr>
                {% for col in prediction_results[0].keys() %}
                <th>{{ col.replace('_', ' ')|capitalize }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in prediction_results %}
              <tr>
                {% for val in row.values() %}
                <td>{{ val }}</td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container text-center">
      <p class="mb-0">Â© 2025 FinancialAid System. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
